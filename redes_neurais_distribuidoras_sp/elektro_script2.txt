function [y1,xf1,xf2] = myNeuralNetworkFunction(x1,x2,xi1,xi2)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 26-Jun-2022 18:40:19.
%
% [y1,xf1,xf2] = myNeuralNetworkFunction(x1,x2,xi1,xi2) takes these arguments:
%   x1 = 12xTS matrix, input #1
%   x2 = 1xTS matrix, input #2
%   xi1 = 12x2 matrix, initial 2 delay states for input #1.
%   xi2 = 1x2 matrix, initial 2 delay states for input #2.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 12x2 matrix, final 2 delay states for input #1.
%   xf2 = 1x2 matrix, final 2 delay states for input #2.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.3;11.7;0.1;5.9;5.4;6;2.1;6.7;5.1;4;1.3;6.1];
x1_step1.gain = [0.0561797752808989;0.0763358778625954;0.0687285223367698;0.066006600660066;0.0593471810089021;0.0586510263929619;0.0583090379008746;0.0619195046439629;0.0571428571428571;0.0641025641025641;0.0560224089635854;0.0598802395209581];
x1_step1.ymin = -1;

% Input 2
x2_step1.xoffset = 1367.371948;
x2_step1.gain = 0.000828816634920089;
x2_step1.ymin = -1;

% Layer 1
b1 = [13.636306114601948636;3.3320415913854506407;-0.20057243842512023635;-0.25637217989490679315;0.078680082576957063867;0.099511358183740447614;0.64627302268578401545;-21.95005073980774668;0.49231672277995547349;-0.90601480118575961065];
IW1_1 = [-0.13578343821232810584 -14.376713038123341448 11.800036164503593383 12.201813963997780732 -8.9091565010390176838 2.6236977858223733406 7.7308784733368645092 -17.636647198145357862 -0.056057414850842743337 -0.92705516250795039213 -3.0303807679738916647 -10.282399247748765347 -11.654222061939705668 -10.388141077314195115 -7.2178036772547926603 -5.9423861612975183988 -8.8152103050016599184 2.4503426498021974034 5.3453140929097289202 7.3550313157541999942 20.376302075984074946 -1.5735093898821439495 -0.75862271603535746944 5.34463278136627018;0.080765835525423448904 -1.7135313161394014614 -0.60038940112504068924 -0.84484070860229565358 -1.6269224229946517291 -1.3752003702027228993 -1.2799906228376429773 -0.31628292499500487711 -0.36924668546208488928 -1.1107885482786707954 -1.3385118533873539004 -1.6816403049870718434 0.16381341312788258446 0.48976490941907901977 0.8903822272455020892 0.6048024640999788426 1.1148583331873564983 1.4527446631235465535 1.5658673537513261298 0.22902248099790137315 0.91322120475012857899 0.25241399446945217422 1.7160560370547766063 0.5518331460267896782;2.3613922739695971664 2.8019764259880783897 2.3703968175816929609 -0.35467846022919052862 -0.39168254581924316637 2.3453334017248694821 1.2561116629576758452 0.029927522696216644904 -6.038640193196062711 0.5563350273425576864 2.810923579371503056 -2.014078386432843093 -1.9089261135782669143 -0.81547077499888720453 -3.3114184300952707041 1.4472664075895456115 0.3351013407229282981 0.29153313153348719977 1.1547889963659487833 1.0748563066811791522 1.0632417617715943514 -1.7679017312973990261 -2.7983068986566648206 -0.48220248649342878355;-6.2442493979160129669 21.734020771522654769 5.5044085610237090123 2.3710111586677711237 -6.6172995845171653784 -7.3369509774774508415 -2.3886338924718351073 -4.3490292889465242965 3.3886525114501049316 6.6671436228336249386 29.34935315965992686 -4.416978305440776964 -1.0431543400935296972 -21.900664483949942252 11.969892293264607019 5.3366499974564050035 7.4711435866472895029 14.299533597413748964 -1.1908344752699127067 -2.9320255895069524676 -1.6060438174861237925 -8.7446476741799461507 -18.488175597980131215 -8.2031501101876216353;0.55585379826120984159 0.59297674884855622324 0.33232268005935000632 0.54154361523851213267 0.74453728694171505964 0.048999096735818724324 0.78251907381046081902 0.72584213760189408848 0.65624070697193714885 0.43670935057108306587 0.15284350990718523211 0.95963736427032197973 -0.64125568651902209449 -0.4600870031020750095 -0.13574882920965730682 -0.47063273316301584837 -0.94903653652404817986 -0.4117377954077612312 -0.70496410246868101979 -0.41670407754547522661 -0.5496522437497727287 -0.42547602225304947954 -0.12854879224595372467 -0.79115605951980039201;-0.15633154042039312803 -0.087245441899248668549 -0.10965780772197369908 -0.13908641159763515671 0.051968936806750784529 -0.01275139032960929085 0.29402919707062663557 -0.2895292680646965322 0.2681100361318872749 -0.17880802592692515707 -0.15612334696789031963 0.0046861554980250890584 0.081918590301751387228 -0.00646499164164557414 0.13502052004660161644 0.02309415704378471601 -0.054353769223197630212 -0.088751738710979091729 -0.32378431041197414109 0.20638600302820270249 0.028963585972526691148 0.21485254624784863586 0.1231997074508187906 0.017573052949696851138;2.3577165719963235624 -2.7477946359318421443 -2.2496710770781742639 2.2064580890836675842 0.20711362429694829546 -0.50530688826563319171 -5.4003626436798777277 0.39186112349169210933 -1.7068649842038932096 -3.9616985365983721223 -3.192651187921736522 0.1184345517575808443 -1.2643570128007930453 3.9447145459081665031 -0.1206667746539115682 -3.2151817102264796944 -0.087406363787418409061 0.34584232540986536986 7.064400733453636505 -0.077710822398482759521 -1.5355827244576321089 3.8599039411830635693 -0.6949442198931551351 0.93896924875342990813;-21.001267368491198795 -6.9462627013693838407 44.458932216824521788 -20.614297161036205353 -95.30316321752992792 -41.186075824859450734 8.9510314975661930958 -16.298524652966523973 -34.552063813976012341 -17.527008389988562698 -35.844779672144980509 0.075724665977594377009 46.746850425515397376 16.709389326097593198 -44.455555403458255626 24.413379609996912478 -35.785042329578466536 30.405233341372156275 25.430948604786255629 9.5799079957164448018 -44.610492804415613932 10.976084352022693835 -14.295984428740005967 65.09386193189311598;0.15554190261634101566 -0.16975623173498913254 0.0023773145783422319072 0.22060465314459229424 -0.51571033098216234603 -0.24972679469039546496 -1.2450133899856861142 0.67011352543926461234 -0.70906540792940075946 0.29257109650392171263 0.19016973101170023264 -0.28979384625509485574 0.147509178132303298 0.23017720942676106466 -0.18258025294521265658 0.037737391925331847942 0.54151508268350978526 0.50815554822624842135 1.0469533297144160144 -0.47533679227612651852 0.018814881469052940899 -0.26258900003734331197 -0.043308838413808024848 0.33913019516290970889;0.12036972558997635629 0.023609200777776822439 0.096420870678650724694 0.049985456667964327238 -0.17355967620233891946 0.03075821526926750607 -0.38231244091714616795 0.26494143056312818851 -0.37778964862877290054 0.20298801306040989423 0.1941918276106344432 -0.13906238386613045677 -0.030344759005886321607 0.072382083938448193994 -0.13821651976089366354 0.075019267940601014333 0.17928545317347080457 0.14194321544509314048 0.40738347882799669231 -0.20137487837003675839 0.02636735384566052387 -0.27208842739671135202 -0.13029572507734069053 0.055691705232008469062];
IW1_2 = [22.209412795135776264 -5.9204042394024209983;-6.0744291424232548238 11.832075474281017691;6.0631261842754291536 -14.435235985303194184;-16.19129136522234802 10.136163939395569145;-8.3021058255184385644 7.8347207341010536297;2.3115850468443350785 -1.3487636877906565847;1.1654978050712059279 1.4159515948330383406;189.79523209780285242 -226.19027570935355698;-6.2833924656688671107 3.1063247239753719597;-3.1643743367147818546 1.4485978488288189236];

% Layer 2
b2 = -0.65231149250946396378;
LW2_1 = [-0.013971883738164974503 0.053497155369725497842 -0.055250812316063199758 -0.0084381166478782344137 -0.24577197219163510189 -1.9603098811867774032 -0.03078672479828616429 0.0048057618275275607728 -0.50904277969781885904 -1.360871761128524593];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.000828816634920089;
y1_step1.xoffset = 1367.371948;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(12,1)];

% Input 2 Delay States
xd2 = mapminmax_apply(xi2,x2_step1);
xd2 = [xd2 zeros(1,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+1,3)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Input 2
    xd2(:,xdts) = mapminmax_apply(x2(:,ts),x2_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2]-1,3)+1),24,1);
    tapdelay2 = reshape(xd2(:,mod(xdts-[1 2]-1,3)+1),2,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1 + IW1_2*tapdelay2);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 2);
xits = finalxts(finalxts<=2);
xts = finalxts(finalxts>2)-2;
xf1 = [xi1(:,xits) x1(:,xts)];
xf2 = [xi2(:,xits) x2(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
